<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hapihapihapi</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="card">
    <h2>Tic-Tac-Toe</h2>
    <div class="board">
      <div class="cell" data-index="0"></div>
      <div class="cell" data-index="1"></div>
      <div class="cell" data-index="2"></div>
      <div class="cell" data-index="3"></div>
      <div class="cell" data-index="4"></div>
      <div class="cell" data-index="5"></div>
      <div class="cell" data-index="6"></div>
      <div class="cell" data-index="7"></div>
      <div class="cell" data-index="8"></div>
    </div>
    <button class="reset">Reset Game</button>
  </div>

  <div class="popup" id="popup">
    <img id="popupGif" src="assets/mimi_flower.gif">
    <h2 id="popupText">Yayy! ðŸ’• Will you be my Valentine?</h2>

    <div id="valentineButtons" style="display:flex; justify-content:center; gap:20px;">
      <button id="yesBtn">Yes</button>
      <button id="noBtn">No</button>
    </div>
  </div>

  <div id="celebrationPopup">
    <h2>hihihi ðŸ’–</h2>
    <img src="assets/yay.gif">
  </div>

  <button id="tryAgainBtn">ðŸ”„</button>

<script>
const cells = document.querySelectorAll('.cell');
const resetBtn = document.querySelector('.reset');
const popup = document.getElementById('popup');
const celebrationPopup = document.getElementById('celebrationPopup');
const yesBtn = document.getElementById("yesBtn");
const tryAgainBtn = document.getElementById("tryAgainBtn");
const noBtn = document.getElementById("noBtn");

const popupText = document.getElementById("popupText");
const popupGif = document.getElementById("popupGif");
const valentineButtons = document.getElementById("valentineButtons");

let board = Array(9).fill("");
let gameOver = false;

const winCombos = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];


// NO BUTTON DODGE
noBtn.addEventListener("mouseenter", () => {
  const randX = Math.floor(Math.random()*150)-75;
  const randY = Math.floor(Math.random()*50)-25;
  noBtn.style.transform = `translate(${randX}px, ${randY}px)`;
});
noBtn.addEventListener("mouseleave", () => {
  noBtn.style.transform = "translate(0,0)";
});


// WIN CHECK
function checkWin(player){
  return winCombos.some(combo => combo.every(i => board[i] === player));
}

function checkWinBoard(testBoard, player){
  return winCombos.some(combo => combo.every(i => testBoard[i] === player));
}

function checkTie(){
  return board.every(cell => cell !== "");
}


function showPopup(winner){
  gameOver = true;

  if(winner === "X"){
    popupText.textContent = "Yayy! ðŸ’• Will you be my Valentine?";
    popupGif.src = "assets/mimi_flower.gif";
    valentineButtons.style.display = "flex";
  }

  if(winner === "O"){
    popupText.textContent = "Awh (i find it hard aswell)";
    popupGif.src = "assets/issoke.gif";
    valentineButtons.style.display = "none";
  }

  popup.style.display = "block";
}


function resetGame(){
  board.fill("");
  cells.forEach(cell => cell.textContent = "");
  popup.style.display = "none";
  celebrationPopup.style.display = "none";
  tryAgainBtn.style.display = "none";
  gameOver = false;
}


cells.forEach(cell => {
  cell.addEventListener('click', () => {
    const index = cell.dataset.index;

    if(board[index] === "" && !gameOver){
      board[index] = "X";
      cell.textContent = "X";

      if(checkWin("X")){
        showPopup("X");
        return;
      }

      if(checkTie()){
        alert("Skill issue. Try again hmp!");
        resetGame();
        return;
      }

      setTimeout(computerMove, 300);
    }
  });
});


function minimax(newBoard, player){
  const emptySpots = newBoard.map((v,i)=> v===""? i:null).filter(v=>v!==null);

  if(checkWinBoard(newBoard,"X")) return {score:-10};
  if(checkWinBoard(newBoard,"O")) return {score:10};
  if(emptySpots.length===0) return {score:0};

  let moves=[];

  for(let i=0;i<emptySpots.length;i++){
    let move={};
    move.index = emptySpots[i];

    newBoard[emptySpots[i]] = player;

    if(player==="O"){
      move.score = minimax(newBoard,"X").score;
    } else {
      move.score = minimax(newBoard,"O").score;
    }

    newBoard[emptySpots[i]] = "";
    moves.push(move);
  }

  let bestMove;

  if(player==="O"){
    let bestScore=-Infinity;
    for(let i=0;i<moves.length;i++){
      if(moves[i].score>bestScore){
        bestScore=moves[i].score;
        bestMove=i;
      }
    }
  } else {
    let bestScore=Infinity;
    for(let i=0;i<moves.length;i++){
      if(moves[i].score<bestScore){
        bestScore=moves[i].score;
        bestMove=i;
      }
    }
  }

  return moves[bestMove];
}


function computerMove(){
  if(gameOver) return;

  let moveChance = Math.random();
  let bestSpot;

  if(moveChance < 0.90){
    bestSpot = minimax([...board],"O").index;
  } 
  else {
    const empty = board.map((v,i)=> v===""? i:null).filter(v=>v!==null);
    bestSpot = empty[Math.floor(Math.random()*empty.length)];
  }

  if(bestSpot === undefined) return;

  board[bestSpot] = "O";
  cells[bestSpot].textContent = "O";

  if(checkWin("O")){
    showPopup("O");
    return;
  }

  if(checkTie()){
    alert("Skill issue. Try again hmp!");
    resetGame();
  }
}



resetBtn.addEventListener('click', resetGame);
tryAgainBtn.addEventListener("click", resetGame);


yesBtn.addEventListener("click", () => {
  celebrationPopup.style.display="block";

  const colors=["#ff69b4","#ff1493","#ffb6c1","#fff0f5","#ffc0cb"];

  for(let i=0;i<500;i++){
    const fw=document.createElement("div");
    fw.classList.add("firework-piece");
    fw.style.backgroundColor=colors[Math.floor(Math.random()*colors.length)];

    const angle=Math.random()*2*Math.PI;
    const distance=150+Math.random()*100;
    const x=Math.cos(angle)*distance;
    const y=Math.sin(angle)*distance;

    fw.style.setProperty("--x",x+"px");
    fw.style.setProperty("--y",y+"px");

    document.body.appendChild(fw);
    setTimeout(()=>fw.remove(),1000);
  }

  setTimeout(()=> tryAgainBtn.style.display="block",1000);
});
</script>

</body>
</html>
